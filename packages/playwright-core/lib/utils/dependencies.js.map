{"version":3,"sources":["../../src/utils/dependencies.ts"],"names":["BIN_DIRECTORY","path","join","__dirname","checkExecutable","filePath","fs","promises","access","constants","X_OK","then","catch","e","isSupportedWindowsVersion","os","platform","arch","major","minor","release","split","map","token","parseInt","installDependenciesWindows","targets","has","code","utils","spawnAsync","cwd","stdio","Error","installDependenciesLinux","ubuntuVersion","console","warn","libraries","deps","require","target","push","uniqueLibraries","Array","from","Set","log","commands","command","args","buildAptProcessArgs","child","childProcess","spawn","Promise","resolve","reject","on","isRoot","process","getuid","sudoExists","validateDependenciesWindows","windowsExeAndDllDirectories","directoryPaths","lddPaths","directoryPath","executablesOrSharedLibraries","allMissingDeps","all","lddPath","missingFileDependenciesWindows","missingDeps","dep","add","size","isCrtMissing","isMediaFoundationMissing","startsWith","details","message","validateDependenciesLinux","sdkLanguage","linuxLddDirectories","dlOpenLibraries","missingFileDependencies","missingDLOPENLibraries","missingPackages","libraryToPackageNameMapping","LIBRARY_TO_PACKAGE_NAME_UBUNTU_18_04","LIBRARY_TO_PACKAGE_NAME_UBUNTU_20_04","LIBRARY_TO_PACKAGE_NAME_UBUNTU_21_04","Object","assign","MANUAL_LIBRARY_TO_PACKAGE_NAME_UBUNTU","missingDep","packageName","delete","maybeSudo","wrapInASCIIBox","missingPackagesMessage","missingDependenciesMessage","header","isSharedLib","basename","endsWith","includes","allPaths","readdir","file","allStats","aPath","stat","filePaths","filter","index","isFile","executablersOrLibraries","toLowerCase","Boolean","executable","dirname","stdout","env","LD_LIBRARY_PATH","line","trim","extraLDPaths","length","error","isLibraryAvailable","library"],"mappings":";;;;;;;;;;AAgBA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAUA,MAAMA,aAAa,GAAGC,cAAKC,IAAL,CAAUC,SAAV,EAAqB,IAArB,EAA2B,IAA3B,EAAiC,KAAjC,CAAtB;;AAEA,MAAMC,eAAe,GAAIC,QAAD,IAAsBC,YAAGC,QAAH,CAAYC,MAAZ,CAAmBH,QAAnB,EAA6BC,YAAGG,SAAH,CAAaC,IAA1C,EAAgDC,IAAhD,CAAqD,MAAM,IAA3D,EAAiEC,KAAjE,CAAuEC,CAAC,IAAI,KAA5E,CAA9C;;AAEA,SAASC,yBAAT,GAA8C;AAC5C,MAAIC,EAAE,CAACC,QAAH,OAAkB,OAAlB,IAA6BD,EAAE,CAACE,IAAH,OAAc,KAA/C,EACE,OAAO,KAAP;AACF,QAAM,CAACC,KAAD,EAAQC,KAAR,IAAiBJ,EAAE,CAACK,OAAH,GAAaC,KAAb,CAAmB,GAAnB,EAAwBC,GAAxB,CAA4BC,KAAK,IAAIC,QAAQ,CAACD,KAAD,EAAQ,EAAR,CAA7C,CAAvB,CAH4C,CAI5C;AACA;AACA;;AACA,SAAOL,KAAK,GAAG,CAAR,IAAcA,KAAK,KAAK,CAAV,IAAeC,KAAK,GAAG,CAA5C;AACD;;AAIM,eAAeM,0BAAf,CAA0CC,OAA1C,EAAyE;AAC9E,MAAIA,OAAO,CAACC,GAAR,CAAY,UAAZ,CAAJ,EAA6B;AAC3B,UAAM;AAAEC,MAAAA;AAAF,QAAW,MAAMC,KAAK,CAACC,UAAN,CAAiB,gBAAjB,EAAmC,CAAC,kBAAD,EAAqB,QAArB,EAA+B,OAA/B,EAAwC7B,cAAKC,IAAL,CAAUF,aAAV,EAAyB,wBAAzB,CAAxC,CAAnC,EAAgI;AAAE+B,MAAAA,GAAG,EAAE/B,aAAP;AAAsBgC,MAAAA,KAAK,EAAE;AAA7B,KAAhI,CAAvB;AACA,QAAIJ,IAAI,KAAK,CAAb,EACE,MAAM,IAAIK,KAAJ,CAAU,yCAAV,CAAN;AACH;AACF;;AAEM,eAAeC,wBAAf,CAAwCR,OAAxC,EAAuE;AAC5E,QAAMS,aAAa,GAAG,MAAM,sCAA5B;;AACA,MAAIA,aAAa,KAAK,OAAlB,IAA6BA,aAAa,KAAK,OAA/C,IAA0DA,aAAa,KAAK,OAAhF,EAAyF;AACvFC,IAAAA,OAAO,CAACC,IAAR,CAAa,0DAAb,EADuF,CACZ;;AAC3E;AACD;;AAED,QAAMC,SAAmB,GAAG,EAA5B;;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAWC,OAAO,CAAC,eAAD,CAAxB;;AACA,OAAK,MAAMC,MAAX,IAAqBf,OAArB,EAA8B;AAC5B,QAAIS,aAAa,KAAK,OAAtB,EACEG,SAAS,CAACI,IAAV,CAAe,GAAGH,IAAI,CAAC,QAAD,CAAJ,CAAeE,MAAf,CAAlB,EADF,KAEK,IAAIN,aAAa,KAAK,OAAtB,EACHG,SAAS,CAACI,IAAV,CAAe,GAAGH,IAAI,CAAC,OAAD,CAAJ,CAAcE,MAAd,CAAlB,EADG,KAEA,IAAIN,aAAa,KAAK,OAAtB,EACHG,SAAS,CAACI,IAAV,CAAe,GAAGH,IAAI,CAAC,SAAD,CAAJ,CAAgBE,MAAhB,CAAlB;AACH;;AACD,QAAME,eAAe,GAAGC,KAAK,CAACC,IAAN,CAAW,IAAIC,GAAJ,CAAQR,SAAR,CAAX,CAAxB;AACAF,EAAAA,OAAO,CAACW,GAAR,CAAY,mCAAZ,EAlB4E,CAkBzB;;AACnD,QAAMC,QAAkB,GAAG,EAA3B;AACAA,EAAAA,QAAQ,CAACN,IAAT,CAAc,gBAAd;AACAM,EAAAA,QAAQ,CAACN,IAAT,CAAc,CAAC,SAAD,EAAY,SAAZ,EAAuB,IAAvB,EAA6B,yBAA7B,EACZ,GAAGC,eADS,EAEZzC,IAFY,CAEP,GAFO,CAAd;AAGA,QAAM,CAAC+C,OAAD,EAAUC,IAAV,IAAkB,MAAMC,mBAAmB,CAACH,QAAD,CAAjD;;AACA,QAAMI,KAAK,GAAGC,uBAAaC,KAAb,CAAmBL,OAAnB,EAA4BC,IAA5B,EAAkC;AAAElB,IAAAA,KAAK,EAAE;AAAT,GAAlC,CAAd;;AACA,QAAM,IAAIuB,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACrCL,IAAAA,KAAK,CAACM,EAAN,CAAS,MAAT,EAAiBF,OAAjB;AACAJ,IAAAA,KAAK,CAACM,EAAN,CAAS,OAAT,EAAkBD,MAAlB;AACD,GAHK,CAAN;AAID;;AAED,eAAeN,mBAAf,CAAmCH,QAAnC,EAAoF;AAClF,QAAMW,MAAM,GAAGC,OAAO,CAACC,MAAR,OAAqB,CAApC;AACA,MAAIF,MAAJ,EACE,OAAO,CAAC,IAAD,EAAO,CAAC,IAAD,EAAQ,GAAEX,QAAQ,CAAC9C,IAAT,CAAc,KAAd,CAAqB,EAA/B,CAAP,CAAP;AACF,QAAM4D,UAAU,GAAG,MAAMjC,KAAK,CAACC,UAAN,CAAiB,OAAjB,EAA0B,CAAC,MAAD,CAA1B,CAAzB;AACA,MAAIgC,UAAU,CAAClC,IAAX,KAAoB,CAAxB,EACE,OAAO,CAAC,MAAD,EAAS,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAoB,GAAEoB,QAAQ,CAAC9C,IAAT,CAAc,KAAd,CAAqB,EAA3C,CAAT,CAAP;AACF,SAAO,CAAC,IAAD,EAAO,CAAC,MAAD,EAAS,IAAT,EAAgB,GAAE8C,QAAQ,CAAC9C,IAAT,CAAc,KAAd,CAAqB,EAAvC,CAAP,CAAP;AACD;;AAEM,eAAe6D,2BAAf,CAA2CC,2BAA3C,EAAkF;AACvF,QAAMC,cAAc,GAAGD,2BAAvB;AACA,QAAME,QAAkB,GAAG,EAA3B;;AACA,OAAK,MAAMC,aAAX,IAA4BF,cAA5B,EACEC,QAAQ,CAACxB,IAAT,CAAc,IAAI,MAAM0B,4BAA4B,CAACD,aAAD,CAAtC,CAAd;;AACF,QAAME,cAAc,GAAG,MAAMd,OAAO,CAACe,GAAR,CAAYJ,QAAQ,CAAC5C,GAAT,CAAaiD,OAAO,IAAIC,8BAA8B,CAACD,OAAD,CAAtD,CAAZ,CAA7B;AACA,QAAME,WAAwB,GAAG,IAAI3B,GAAJ,EAAjC;;AACA,OAAK,MAAMP,IAAX,IAAmB8B,cAAnB,EAAmC;AACjC,SAAK,MAAMK,GAAX,IAAkBnC,IAAlB,EACEkC,WAAW,CAACE,GAAZ,CAAgBD,GAAhB;AACH;;AAED,MAAI,CAACD,WAAW,CAACG,IAAjB,EACE;AAEF,MAAIC,YAAY,GAAG,KAAnB;AACA,MAAIC,wBAAwB,GAAG,KAA/B;;AACA,OAAK,MAAMJ,GAAX,IAAkBD,WAAlB,EAA+B;AAC7B,QAAIC,GAAG,CAACK,UAAJ,CAAe,gBAAf,KAAoCL,GAAG,KAAK,kBAA5C,IAAkEA,GAAG,KAAK,oBAA1E,IAAkGA,GAAG,KAAK,cAA9G,EACEG,YAAY,GAAG,IAAf,CADF,KAEK,IAAIH,GAAG,KAAK,QAAR,IAAoBA,GAAG,KAAK,YAA5B,IAA6CA,GAAG,KAAK,iBAArD,IAA0EA,GAAG,KAAK,SAAlF,IAA+FA,GAAG,KAAK,UAA3G,EACHI,wBAAwB,GAAG,IAA3B;AACH;;AAED,QAAME,OAAO,GAAG,EAAhB;;AAEA,MAAIH,YAAJ,EAAkB;AAChBG,IAAAA,OAAO,CAACtC,IAAR,CACK,kFADL,EAEK,iFAFL,EAGK,0FAHL,EAIK,EAJL;AAKD;;AAED,MAAIoC,wBAAJ,EAA8B;AAC5BE,IAAAA,OAAO,CAACtC,IAAR,CACK,8EADL,EAEK,kFAFL,EAGK,mBAHL,EAIK,EAJL,EAKK,oDALL,EAMK,EANL,EAOK,+BAPL,EAQK,iGARL,EASK,EATL;AAUD;;AAEDsC,EAAAA,OAAO,CAACtC,IAAR,CACK,iCADL,EAEK,OAAM,CAAC,GAAG+B,WAAJ,EAAiBvE,IAAjB,CAAsB,QAAtB,CAAgC,EAF3C,EAGK,EAHL;AAKA,QAAM+E,OAAO,GAAI,2CAA0CD,OAAO,CAAC9E,IAAR,CAAa,IAAb,CAAmB,EAA9E;;AACA,MAAIY,yBAAyB,EAA7B,EAAiC;AAC/B,UAAM,IAAImB,KAAJ,CAAUgD,OAAV,CAAN;AACD,GAFD,MAEO;AACL7C,IAAAA,OAAO,CAACC,IAAR,CAAc,kDAAd;AACAD,IAAAA,OAAO,CAACC,IAAR,CAAa4C,OAAb;AACD;AACF;;AAEM,eAAeC,yBAAf,CAAyCC,WAAzC,EAA8DC,mBAA9D,EAA6FC,eAA7F,EAAwH;AAC7H,QAAMpB,cAAc,GAAGmB,mBAAvB;AACA,QAAMlB,QAAkB,GAAG,EAA3B;;AACA,OAAK,MAAMC,aAAX,IAA4BF,cAA5B,EACEC,QAAQ,CAACxB,IAAT,CAAc,IAAI,MAAM0B,4BAA4B,CAACD,aAAD,CAAtC,CAAd;;AACF,QAAME,cAAc,GAAG,MAAMd,OAAO,CAACe,GAAR,CAAYJ,QAAQ,CAAC5C,GAAT,CAAaiD,OAAO,IAAIe,uBAAuB,CAACf,OAAD,EAAUN,cAAV,CAA/C,CAAZ,CAA7B;AACA,QAAMQ,WAAwB,GAAG,IAAI3B,GAAJ,EAAjC;;AACA,OAAK,MAAMP,IAAX,IAAmB8B,cAAnB,EAAmC;AACjC,SAAK,MAAMK,GAAX,IAAkBnC,IAAlB,EACEkC,WAAW,CAACE,GAAZ,CAAgBD,GAAhB;AACH;;AACD,OAAK,MAAMA,GAAX,IAAmB,MAAMa,sBAAsB,CAACF,eAAD,CAA/C,EACEZ,WAAW,CAACE,GAAZ,CAAgBD,GAAhB;;AACF,MAAI,CAACD,WAAW,CAACG,IAAjB,EACE,OAd2H,CAe7H;;AACA,QAAMY,eAAe,GAAG,IAAI1C,GAAJ,EAAxB;AAEA,QAAMX,aAAa,GAAG,MAAM,sCAA5B;AACA,MAAIsD,2BAA2B,GAAG,IAAlC;AACA,MAAItD,aAAa,KAAK,OAAtB,EACEsD,2BAA2B,GAAGC,oCAA9B,CADF,KAEK,IAAIvD,aAAa,KAAK,OAAtB,EACHsD,2BAA2B,GAAGE,oCAA9B,CADG,KAEA,IAAIxD,aAAa,KAAK,OAAtB,EACHsD,2BAA2B,GAAGG,oCAA9B;AACFH,EAAAA,2BAA2B,GAAGI,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBL,2BAAlB,EAA+CM,qCAA/C,CAA9B;;AACA,MAAIN,2BAAJ,EAAiC;AAC/B;AACA,SAAK,MAAMO,UAAX,IAAyBvB,WAAzB,EAAsC;AACpC,YAAMwB,WAAW,GAAGR,2BAA2B,CAACO,UAAD,CAA/C;;AACA,UAAIC,WAAJ,EAAiB;AACfT,QAAAA,eAAe,CAACb,GAAhB,CAAoBsB,WAApB;AACAxB,QAAAA,WAAW,CAACyB,MAAZ,CAAmBF,UAAnB;AACD;AACF;AACF;;AAED,QAAMG,SAAS,GAAIvC,OAAO,CAACC,MAAR,OAAqB,CAAtB,IAA4B9C,EAAE,CAACC,QAAH,OAAkB,OAA9C,GAAwD,OAAxD,GAAkE,EAApF,CAtC6H,CAuC7H;AACA;;AACA,MAAIwE,eAAe,CAACZ,IAAhB,IAAwB,CAACH,WAAW,CAACG,IAAzC,EAA+C;AAC7C,UAAM,IAAI3C,KAAJ,CAAU,OAAOJ,KAAK,CAACuE,cAAN,CAAqB,CACzC,4DADyC,EAEzC,iDAFyC,EAGzC,EAHyC,EAIzC,OAAMD,SAAU,GAAE,yCAA0BhB,WAA1B,EAAuC,cAAvC,CAAuD,EAJhC,EAKzC,EALyC,EAMzC,oBANyC,EAO1CjF,IAP0C,CAOrC,IAPqC,CAArB,EAOT,CAPS,CAAjB,CAAN;AAQD,GAlD4H,CAoD7H;;;AACA,MAAImG,sBAAsB,GAAG,EAA7B;;AACA,MAAIb,eAAe,CAACZ,IAApB,EAA0B;AACxByB,IAAAA,sBAAsB,GAAG,CACtB,kCADsB,EAEtB,SAAQF,SAAU,mBAAkB,CAAC,GAAGX,eAAJ,EAAqBtF,IAArB,CAA0B,gBAA1B,CAA4C,EAF1D,EAGtB,EAHsB,EAItB,EAJsB,EAKvBA,IALuB,CAKlB,IALkB,CAAzB;AAMD;;AAED,MAAIoG,0BAA0B,GAAG,EAAjC;;AACA,MAAI7B,WAAW,CAACG,IAAhB,EAAsB;AACpB,UAAM2B,MAAM,GAAGf,eAAe,CAACZ,IAAhB,GAAwB,gDAAxB,GAA2E,wBAA1F;AACA0B,IAAAA,0BAA0B,GAAG,CAC1B,KAAIC,MAAO,EADe,EAE1B,SAAQ,CAAC,GAAG9B,WAAJ,EAAiBvE,IAAjB,CAAsB,UAAtB,CAAkC,EAFhB,EAG1B,EAH0B,EAI3BA,IAJ2B,CAItB,IAJsB,CAA7B;AAKD;;AAED,QAAM,IAAI+B,KAAJ,CAAU,6CAA6CoE,sBAA7C,GAAsEC,0BAAhF,CAAN;AACD;;AAED,SAASE,WAAT,CAAqBC,QAArB,EAAuC;AACrC,UAAQ1F,EAAE,CAACC,QAAH,EAAR;AACE,SAAK,OAAL;AACE,aAAOyF,QAAQ,CAACC,QAAT,CAAkB,KAAlB,KAA4BD,QAAQ,CAACE,QAAT,CAAkB,MAAlB,CAAnC;;AACF,SAAK,OAAL;AACE,aAAOF,QAAQ,CAACC,QAAT,CAAkB,MAAlB,CAAP;;AACF;AACE,aAAO,KAAP;AANJ;AAQD;;AAED,eAAetC,4BAAf,CAA4CD,aAA5C,EAAsF;AACpF,QAAMyC,QAAQ,GAAG,CAAC,MAAMtG,YAAGC,QAAH,CAAYsG,OAAZ,CAAoB1C,aAApB,CAAP,EAA2C7C,GAA3C,CAA+CwF,IAAI,IAAI7G,cAAKuD,OAAL,CAAaW,aAAb,EAA4B2C,IAA5B,CAAvD,CAAjB;AACA,QAAMC,QAAQ,GAAG,MAAMxD,OAAO,CAACe,GAAR,CAAYsC,QAAQ,CAACtF,GAAT,CAAa0F,KAAK,IAAI1G,YAAGC,QAAH,CAAY0G,IAAZ,CAAiBD,KAAjB,CAAtB,CAAZ,CAAvB;AACA,QAAME,SAAS,GAAGN,QAAQ,CAACO,MAAT,CAAgB,CAACH,KAAD,EAAQI,KAAR,KAAmBL,QAAQ,CAACK,KAAD,CAAT,CAAyBC,MAAzB,EAAlC,CAAlB;AAEA,QAAMC,uBAAuB,GAAG,CAAC,MAAM/D,OAAO,CAACe,GAAR,CAAY4C,SAAS,CAAC5F,GAAV,CAAc,MAAMjB,QAAN,IAAkB;AACjF,UAAMoG,QAAQ,GAAGxG,cAAKwG,QAAL,CAAcpG,QAAd,EAAwBkH,WAAxB,EAAjB;;AACA,QAAIf,WAAW,CAACC,QAAD,CAAf,EACE,OAAOpG,QAAP;AACF,QAAI,MAAMD,eAAe,CAACC,QAAD,CAAzB,EACE,OAAOA,QAAP;AACF,WAAO,KAAP;AACD,GAPkD,CAAZ,CAAP,EAO3B8G,MAP2B,CAOpBK,OAPoB,CAAhC;AASA,SAAOF,uBAAP;AACD;;AAED,eAAe9C,8BAAf,CAA8CnE,QAA9C,EAAwF;AACtF,QAAMoH,UAAU,GAAGxH,cAAKC,IAAL,CAAUC,SAAV,EAAqB,IAArB,EAA2B,IAA3B,EAAiC,KAAjC,EAAwC,eAAxC,CAAnB;;AACA,QAAMuH,OAAO,GAAGzH,cAAKyH,OAAL,CAAarH,QAAb,CAAhB;;AACA,QAAM;AAAEsH,IAAAA,MAAF;AAAU/F,IAAAA;AAAV,MAAmB,MAAMC,KAAK,CAACC,UAAN,CAAiB2F,UAAjB,EAA6B,CAACpH,QAAD,CAA7B,EAAyC;AACtE0B,IAAAA,GAAG,EAAE2F,OADiE;AAEtEE,IAAAA,GAAG,EAAE,EACH,GAAGhE,OAAO,CAACgE,GADR;AAEHC,MAAAA,eAAe,EAAEjE,OAAO,CAACgE,GAAR,CAAYC,eAAZ,GAA+B,GAAEjE,OAAO,CAACgE,GAAR,CAAYC,eAAgB,IAAGH,OAAQ,EAAxE,GAA4EA;AAF1F;AAFiE,GAAzC,CAA/B;AAOA,MAAI9F,IAAI,KAAK,CAAb,EACE,OAAO,EAAP;AACF,QAAM6C,WAAW,GAAGkD,MAAM,CAACtG,KAAP,CAAa,IAAb,EAAmBC,GAAnB,CAAuBwG,IAAI,IAAIA,IAAI,CAACC,IAAL,EAA/B,EAA4CZ,MAA5C,CAAmDW,IAAI,IAAIA,IAAI,CAACpB,QAAL,CAAc,WAAd,KAA8BoB,IAAI,CAACnB,QAAL,CAAc,IAAd,CAAzF,EAA8GrF,GAA9G,CAAkHwG,IAAI,IAAIA,IAAI,CAACzG,KAAL,CAAW,IAAX,EAAiB,CAAjB,EAAoB0G,IAApB,GAA2BR,WAA3B,EAA1H,CAApB;AACA,SAAO9C,WAAP;AACD;;AAED,eAAea,uBAAf,CAAuCjF,QAAvC,EAAyD2H,YAAzD,EAAyG;AACvG,QAAMN,OAAO,GAAGzH,cAAKyH,OAAL,CAAarH,QAAb,CAAhB;;AACA,MAAIwH,eAAe,GAAGG,YAAY,CAAC9H,IAAb,CAAkB,GAAlB,CAAtB;AACA,MAAI0D,OAAO,CAACgE,GAAR,CAAYC,eAAhB,EACEA,eAAe,GAAI,GAAEjE,OAAO,CAACgE,GAAR,CAAYC,eAAgB,IAAGA,eAAgB,EAApE;AACF,QAAM;AAAEF,IAAAA,MAAF;AAAU/F,IAAAA;AAAV,MAAmB,MAAMC,KAAK,CAACC,UAAN,CAAiB,KAAjB,EAAwB,CAACzB,QAAD,CAAxB,EAAoC;AACjE0B,IAAAA,GAAG,EAAE2F,OAD4D;AAEjEE,IAAAA,GAAG,EAAE,EACH,GAAGhE,OAAO,CAACgE,GADR;AAEHC,MAAAA;AAFG;AAF4D,GAApC,CAA/B;AAOA,MAAIjG,IAAI,KAAK,CAAb,EACE,OAAO,EAAP;AACF,QAAM6C,WAAW,GAAGkD,MAAM,CAACtG,KAAP,CAAa,IAAb,EAAmBC,GAAnB,CAAuBwG,IAAI,IAAIA,IAAI,CAACC,IAAL,EAA/B,EAA4CZ,MAA5C,CAAmDW,IAAI,IAAIA,IAAI,CAACpB,QAAL,CAAc,WAAd,KAA8BoB,IAAI,CAACnB,QAAL,CAAc,IAAd,CAAzF,EAA8GrF,GAA9G,CAAkHwG,IAAI,IAAIA,IAAI,CAACzG,KAAL,CAAW,IAAX,EAAiB,CAAjB,EAAoB0G,IAApB,EAA1H,CAApB;AACA,SAAOtD,WAAP;AACD;;AAED,eAAec,sBAAf,CAAsCjD,SAAtC,EAA8E;AAC5E,MAAI,CAACA,SAAS,CAAC2F,MAAf,EACE,OAAO,EAAP,CAF0E,CAG5E;AACA;AACA;;AACA,QAAM;AAAEN,IAAAA,MAAF;AAAU/F,IAAAA,IAAV;AAAgBsG,IAAAA;AAAhB,MAA0B,MAAMrG,KAAK,CAACC,UAAN,CAAiB,gBAAjB,EAAmC,CAAC,IAAD,CAAnC,EAA2C,EAA3C,CAAtC;AACA,MAAIF,IAAI,KAAK,CAAT,IAAcsG,KAAlB,EACE,OAAO,EAAP;;AACF,QAAMC,kBAAkB,GAAIC,OAAD,IAAqBT,MAAM,CAACJ,WAAP,GAAqBZ,QAArB,CAA8ByB,OAAO,CAACb,WAAR,EAA9B,CAAhD;;AACA,SAAOjF,SAAS,CAAC6E,MAAV,CAAiBiB,OAAO,IAAI,CAACD,kBAAkB,CAACC,OAAD,CAA/C,CAAP;AACD,C,CAED;AACA;;;AACA,MAAM1C,oCAA4D,GAAG;AACnE,oBAAkB,YADiD;AAEnE,qBAAmB,aAFgD;AAGnE,4BAA0B,oBAHyC;AAInE,mBAAiB,eAJkD;AAKnE,uBAAqB,YAL8C;AAMnE,2BAAyB,mBAN0C;AAOnE,mBAAiB,WAPkD;AAQnE,kBAAgB,UARmD;AASnE,oBAAkB,aATiD;AAUnE,yBAAuB,kBAV4C;AAWnE,iBAAe,SAXoD;AAYnE,iBAAe,SAZoD;AAanE,qBAAmB,gBAbgD;AAcnE,mBAAiB,WAdkD;AAenE,uBAAqB,gBAf8C;AAgBnE,mBAAiB,WAhBkD;AAiBnE,wBAAsB,gBAjB6C;AAkBnE,sBAAoB,cAlB+C;AAmBnE,iBAAe,SAnBoD;AAoBnE,4BAA0B,oBApByC;AAqBnE,mBAAiB,YArBkD;AAsBnE,yBAAuB,aAtB4C;AAuBnE,qBAAmB,cAvBgD;AAwBnE,gBAAc,QAxBqD;AAyBnE,oBAAkB,UAzBiD;AA0BnE,sBAAoB,cA1B+C;AA2BnE,yBAAuB,cA3B4C;AA4BnE,yBAAuB,cA5B4C;AA6BnE,wBAAsB,2BA7B6C;AA8BnE,0BAAwB,2BA9B2C;AA+BnE,yBAAuB,mBA/B4C;AAgCnE,iCAA+B,0BAhCoC;AAiCnE,wBAAsB,2BAjC6C;AAkCnE,uBAAqB,sBAlC8C;AAmCnE,4BAA0B,2BAnCyC;AAoCnE,2BAAyB,mBApC0C;AAqCnE,wBAAsB,2BArC6C;AAsCnE,0BAAwB,2BAtC2C;AAuCnE,yBAAuB,cAvC4C;AAwCnE,mBAAiB,YAxCkD;AAyCnE,yBAAuB,aAzC4C;AA0CnE,0BAAwB,kBA1C2C;AA2CnE,sBAAoB,eA3C+C;AA4CnE,oBAAkB,YA5CiD;AA6CnE,sBAAoB,UA7C+C;AA8CnE,sBAAoB,UA9C+C;AA+CnE,oBAAkB,UA/CiD;AAgDnE,kBAAgB,gBAhDmD;AAiDnE,oBAAkB,YAjDiD;AAkDnE,iBAAe,UAlDoD;AAmDnE,gBAAc,SAnDqD;AAoDnE,oBAAkB,SApDiD;AAqDnE,qBAAmB,cArDgD;AAsDnE,kBAAgB,UAtDmD;AAuDnE,uBAAqB,gBAvD8C;AAwDnE,4BAA0B,qBAxDyC;AAyDnE,0BAAwB,mBAzD2C;AA0DnE,oBAAkB,aA1DiD;AA2DnE,sBAAoB,eA3D+C;AA4DnE,kBAAgB,SA5DmD;AA6DnE,iBAAe,SA7DoD;AA8DnE,4BAA0B,oBA9DyC;AA+DnE,yBAAuB,iBA/D4C;AAgEnE,4BAA0B,oBAhEyC;AAiEnE,kBAAgB,UAjEmD;AAkEnE,uBAAqB,eAlE8C;AAmEnE,0BAAwB,UAnE2C;AAoEnE,qBAAmB,aApEgD;AAqEnE,iBAAe,UArEoD;AAsEnE,sBAAoB,eAtE+C;AAuEnE,qBAAmB,aAvEgD;AAwEnE,iBAAe,SAxEoD;AAyEnE,wBAAsB,gBAzE6C;AA0EnE,qBAAmB,aA1EgD;AA2EnE,qBAAmB,aA3EgD;AA4EnE,kBAAgB,UA5EmD;AA6EnE,oBAAkB,YA7EiD;AA8EnE,gBAAc,QA9EqD;AA+EnE,uBAAqB,eA/E8C;AAgFnE,kBAAgB,SAhFmD;AAiFnE,oBAAkB,YAjFiD;AAkFnE,qBAAmB,aAlFgD;AAmFnE,kBAAgB,YAnFmD;AAoFnE,gBAAc,QApFqD;AAqFnE,kBAAgB;AArFmD,CAArE,C,CAwFA;AACA;;AACA,MAAMC,oCAA4D,GAAG;AACnE,oBAAkB,YADiD;AAEnE,qBAAmB,aAFgD;AAGnE,4BAA0B,oBAHyC;AAInE,mBAAiB,eAJkD;AAKnE,2BAAyB,mBAL0C;AAMnE,mBAAiB,WANkD;AAOnE,kBAAgB,UAPmD;AAQnE,oBAAkB,aARiD;AASnE,yBAAuB,kBAT4C;AAUnE,iBAAe,SAVoD;AAWnE,iBAAe,SAXoD;AAYnE,qBAAmB,gBAZgD;AAanE,mBAAiB,WAbkD;AAcnE,mBAAiB,WAdkD;AAenE,wBAAsB,gBAf6C;AAgBnE,sBAAoB,cAhB+C;AAiBnE,iBAAe,SAjBoD;AAkBnE,4BAA0B,oBAlByC;AAmBnE,mBAAiB,YAnBkD;AAoBnE,yBAAuB,aApB4C;AAqBnE,qBAAmB,cArBgD;AAsBnE,gBAAc,QAtBqD;AAuBnE,oBAAkB,UAvBiD;AAwBnE,sBAAoB,cAxB+C;AAyBnE,yBAAuB,cAzB4C;AA0BnE,yBAAuB,cA1B4C;AA2BnE,wBAAsB,2BA3B6C;AA4BnE,0BAAwB,2BA5B2C;AA6BnE,yBAAuB,mBA7B4C;AA8BnE,iCAA+B,0BA9BoC;AA+BnE,wBAAsB,2BA/B6C;AAgCnE,uBAAqB,sBAhC8C;AAiCnE,4BAA0B,2BAjCyC;AAkCnE,2BAAyB,mBAlC0C;AAmCnE,wBAAsB,2BAnC6C;AAoCnE,0BAAwB,2BApC2C;AAqCnE,yBAAuB,cArC4C;AAsCnE,mBAAiB,YAtCkD;AAuCnE,yBAAuB,aAvC4C;AAwCnE,0BAAwB,kBAxC2C;AAyCnE,sBAAoB,eAzC+C;AA0CnE,oBAAkB,YA1CiD;AA2CnE,sBAAoB,UA3C+C;AA4CnE,oBAAkB,UA5CiD;AA6CnE,kBAAgB,gBA7CmD;AA8CnE,oBAAkB,YA9CiD;AA+CnE,iBAAe,UA/CoD;AAgDnE,gBAAc,SAhDqD;AAiDnE,oBAAkB,SAjDiD;AAkDnE,qBAAmB,cAlDgD;AAmDnE,kBAAgB,UAnDmD;AAoDnE,uBAAqB,gBApD8C;AAqDnE,4BAA0B,qBArDyC;AAsDnE,0BAAwB,mBAtD2C;AAuDnE,oBAAkB,aAvDiD;AAwDnE,sBAAoB,eAxD+C;AAyDnE,kBAAgB,SAzDmD;AA0DnE,sBAAoB,cA1D+C;AA2DnE,iBAAe,SA3DoD;AA4DnE,4BAA0B,oBA5DyC;AA6DnE,yBAAuB,iBA7D4C;AA8DnE,4BAA0B,oBA9DyC;AA+DnE,kBAAgB,UA/DmD;AAgEnE,uBAAqB,eAhE8C;AAiEnE,0BAAwB,UAjE2C;AAkEnE,qBAAmB,aAlEgD;AAmEnE,iBAAe,UAnEoD;AAoEnE,sBAAoB,eApE+C;AAqEnE,qBAAmB,aArEgD;AAsEnE,iBAAe,SAtEoD;AAuEnE,wBAAsB,gBAvE6C;AAwEnE,qBAAmB,aAxEgD;AAyEnE,qBAAmB,aAzEgD;AA0EnE,kBAAgB,UA1EmD;AA2EnE,oBAAkB,YA3EiD;AA4EnE,gBAAc,QA5EqD;AA6EnE,uBAAqB,eA7E8C;AA8EnE,kBAAgB,SA9EmD;AA+EnE,oBAAkB,YA/EiD;AAgFnE,qBAAmB,aAhFgD;AAiFnE,kBAAgB,YAjFmD;AAkFnE,gBAAc,QAlFqD;AAmFnE,kBAAgB,UAnFmD;AAoFnE,uBAAqB;AApF8C,CAArE;AAuFA,MAAMC,oCAA4D,GAAG;AACnE,oBAAkB,YADiD;AAEnE,qBAAmB,aAFgD;AAGnE,4BAA0B,oBAHyC;AAInE,mBAAiB,eAJkD;AAKnE,2BAAyB,mBAL0C;AAMnE,mBAAiB,WANkD;AAOnE,kBAAgB,UAPmD;AAQnE,oBAAkB,aARiD;AASnE,yBAAuB,kBAT4C;AAUnE,iBAAe,SAVoD;AAWnE,iBAAe,SAXoD;AAYnE,mBAAiB,WAZkD;AAanE,wBAAsB,gBAb6C;AAcnE,sBAAoB,cAd+C;AAenE,iBAAe,SAfoD;AAgBnE,4BAA0B,qBAhByC;AAiBnE,mBAAiB,YAjBkD;AAkBnE,yBAAuB,aAlB4C;AAmBnE,qBAAmB,cAnBgD;AAoBnE,gBAAc,QApBqD;AAqBnE,oBAAkB,UArBiD;AAsBnE,sBAAoB,cAtB+C;AAuBnE,yBAAuB,cAvB4C;AAwBnE,yBAAuB,cAxB4C;AAyBnE,wBAAsB,gCAzB6C;AA0BnE,0BAAwB,gCA1B2C;AA2BnE,yBAAuB,mBA3B4C;AA4BnE,iCAA+B,+BA5BoC;AA6BnE,wBAAsB,gCA7B6C;AA8BnE,uBAAqB,sBA9B8C;AA+BnE,4BAA0B,gCA/ByC;AAgCnE,2BAAyB,mBAhC0C;AAiCnE,wBAAsB,gCAjC6C;AAkCnE,0BAAwB,gCAlC2C;AAmCnE,yBAAuB,cAnC4C;AAoCnE,mBAAiB,YApCkD;AAqCnE,yBAAuB,aArC4C;AAsCnE,0BAAwB,kBAtC2C;AAuCnE,sBAAoB,eAvC+C;AAwCnE,oBAAkB,YAxCiD;AAyCnE,oCAAkC,6BAzCiC;AA0CnE,kBAAgB,gBA1CmD;AA2CnE,mBAAiB,YA3CkD;AA4CnE,oBAAkB,YA5CiD;AA6CnE,iBAAe,UA7CoD;AA8CnE,gBAAc,SA9CqD;AA+CnE,oBAAkB,SA/CiD;AAgDnE,qBAAmB,cAhDgD;AAiDnE,kBAAgB,UAjDmD;AAkDnE,uBAAqB,gBAlD8C;AAmDnE,4BAA0B,qBAnDyC;AAoDnE,0BAAwB,mBApD2C;AAqDnE,oBAAkB,aArDiD;AAsDnE,sBAAoB,eAtD+C;AAuDnE,kBAAgB,SAvDmD;AAwDnE,sBAAoB,cAxD+C;AAyDnE,iBAAe,SAzDoD;AA0DnE,4BAA0B,oBA1DyC;AA2DnE,yBAAuB,iBA3D4C;AA4DnE,4BAA0B,oBA5DyC;AA6DnE,6BAA2B,sBA7DwC;AA8DnE,kBAAgB,UA9DmD;AA+DnE,uBAAqB,eA/D8C;AAgEnE,0BAAwB,UAhE2C;AAiEnE,qBAAmB,cAjEgD;AAkEnE,gCAA8B,yBAlEqC;AAmEnE,2BAAyB,oBAnE0C;AAoEnE,qBAAmB,aApEgD;AAqEnE,iBAAe,UArEoD;AAsEnE,qBAAmB,aAtEgD;AAuEnE,iBAAe,SAvEoD;AAwEnE,wBAAsB,gBAxE6C;AAyEnE,qBAAmB,aAzEgD;AA0EnE,qBAAmB,aA1EgD;AA2EnE,kBAAgB,UA3EmD;AA4EnE,oBAAkB,YA5EiD;AA6EnE,gBAAc,QA7EqD;AA8EnE,uBAAqB,eA9E8C;AA+EnE,kBAAgB,SA/EmD;AAgFnE,oBAAkB,YAhFiD;AAiFnE,qBAAmB,aAjFgD;AAkFnE,uBAAqB,eAlF8C;AAmFnE,kBAAgB,YAnFmD;AAoFnE,gBAAc;AApFqD,CAArE;AAuFA,MAAMG,qCAA6D,GAAG;AACpE;AACA;AACA;AACA;AACA,gBAAc;AALsD,CAAtE","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport * as os from 'os';\nimport childProcess from 'child_process';\nimport { getUbuntuVersion } from './ubuntuVersion';\nimport * as utils from './utils';\nimport { buildPlaywrightCLICommand } from './registry';\n\nconst BIN_DIRECTORY = path.join(__dirname, '..', '..', 'bin');\n\nconst checkExecutable = (filePath: string) => fs.promises.access(filePath, fs.constants.X_OK).then(() => true).catch(e => false);\n\nfunction isSupportedWindowsVersion(): boolean {\n  if (os.platform() !== 'win32' || os.arch() !== 'x64')\n    return false;\n  const [major, minor] = os.release().split('.').map(token => parseInt(token, 10));\n  // This is based on: https://stackoverflow.com/questions/42524606/how-to-get-windows-version-using-node-js/44916050#44916050\n  // The table with versions is taken from: https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-osversioninfoexw#remarks\n  // Windows 7 is not supported and is encoded as `6.1`.\n  return major > 6 || (major === 6 && minor > 1);\n}\n\nexport type DependencyGroup = 'chromium' | 'firefox' | 'webkit' | 'tools';\n\nexport async function installDependenciesWindows(targets: Set<DependencyGroup>) {\n  if (targets.has('chromium')) {\n    const { code } = await utils.spawnAsync('powershell.exe', ['-ExecutionPolicy', 'Bypass', '-File', path.join(BIN_DIRECTORY, 'install_media_pack.ps1')], { cwd: BIN_DIRECTORY, stdio: 'inherit' });\n    if (code !== 0)\n      throw new Error('Failed to install windows dependencies!');\n  }\n}\n\nexport async function installDependenciesLinux(targets: Set<DependencyGroup>) {\n  const ubuntuVersion = await getUbuntuVersion();\n  if (ubuntuVersion !== '18.04' && ubuntuVersion !== '20.04' && ubuntuVersion !== '21.04') {\n    console.warn('Cannot install dependencies for this linux distribution!');  // eslint-disable-line no-console\n    return;\n  }\n\n  const libraries: string[] = [];\n  const { deps } = require('../nativeDeps');\n  for (const target of targets) {\n    if (ubuntuVersion === '18.04')\n      libraries.push(...deps['bionic'][target]);\n    else if (ubuntuVersion === '20.04')\n      libraries.push(...deps['focal'][target]);\n    else if (ubuntuVersion === '21.04')\n      libraries.push(...deps['hirsute'][target]);\n  }\n  const uniqueLibraries = Array.from(new Set(libraries));\n  console.log('Installing Ubuntu dependencies...');  // eslint-disable-line no-console\n  const commands: string[] = [];\n  commands.push('apt-get update');\n  commands.push(['apt-get', 'install', '-y', '--no-install-recommends',\n    ...uniqueLibraries,\n  ].join(' '));\n  const [command, args] = await buildAptProcessArgs(commands);\n  const child = childProcess.spawn(command, args, { stdio: 'inherit' });\n  await new Promise((resolve, reject) => {\n    child.on('exit', resolve);\n    child.on('error', reject);\n  });\n}\n\nasync function buildAptProcessArgs(commands: string[]): Promise<[string, string[]]> {\n  const isRoot = process.getuid() === 0;\n  if (isRoot)\n    return ['sh', ['-c', `${commands.join('&& ')}`]];\n  const sudoExists = await utils.spawnAsync('which', ['sudo']);\n  if (sudoExists.code === 0)\n    return ['sudo', ['--', 'sh', '-c', `${commands.join('&& ')}`]];\n  return ['su', ['root', '-c', `${commands.join('&& ')}`]];\n}\n\nexport async function validateDependenciesWindows(windowsExeAndDllDirectories: string[]) {\n  const directoryPaths = windowsExeAndDllDirectories;\n  const lddPaths: string[] = [];\n  for (const directoryPath of directoryPaths)\n    lddPaths.push(...(await executablesOrSharedLibraries(directoryPath)));\n  const allMissingDeps = await Promise.all(lddPaths.map(lddPath => missingFileDependenciesWindows(lddPath)));\n  const missingDeps: Set<string> = new Set();\n  for (const deps of allMissingDeps) {\n    for (const dep of deps)\n      missingDeps.add(dep);\n  }\n\n  if (!missingDeps.size)\n    return;\n\n  let isCrtMissing = false;\n  let isMediaFoundationMissing = false;\n  for (const dep of missingDeps) {\n    if (dep.startsWith('api-ms-win-crt') || dep === 'vcruntime140.dll' || dep === 'vcruntime140_1.dll' || dep === 'msvcp140.dll')\n      isCrtMissing = true;\n    else if (dep === 'mf.dll' || dep === 'mfplat.dll' ||  dep === 'msmpeg2vdec.dll' || dep === 'evr.dll' || dep === 'avrt.dll')\n      isMediaFoundationMissing = true;\n  }\n\n  const details = [];\n\n  if (isCrtMissing) {\n    details.push(\n        `Some of the Universal C Runtime files cannot be found on the system. You can fix`,\n        `that by installing Microsoft Visual C++ Redistributable for Visual Studio from:`,\n        `https://support.microsoft.com/en-us/help/2977003/the-latest-supported-visual-c-downloads`,\n        ``);\n  }\n\n  if (isMediaFoundationMissing) {\n    details.push(\n        `Some of the Media Foundation files cannot be found on the system. If you are`,\n        `on Windows Server try fixing this by running the following command in PowerShell`,\n        `as Administrator:`,\n        ``,\n        `    Install-WindowsFeature Server-Media-Foundation`,\n        ``,\n        `For Windows N editions visit:`,\n        `https://support.microsoft.com/en-us/help/3145500/media-feature-pack-list-for-windows-n-editions`,\n        ``);\n  }\n\n  details.push(\n      `Full list of missing libraries:`,\n      `    ${[...missingDeps].join('\\n    ')}`,\n      ``);\n\n  const message = `Host system is missing dependencies!\\n\\n${details.join('\\n')}`;\n  if (isSupportedWindowsVersion()) {\n    throw new Error(message);\n  } else {\n    console.warn(`WARNING: running on unsupported windows version!`);\n    console.warn(message);\n  }\n}\n\nexport async function validateDependenciesLinux(sdkLanguage: string, linuxLddDirectories: string[], dlOpenLibraries: string[]) {\n  const directoryPaths = linuxLddDirectories;\n  const lddPaths: string[] = [];\n  for (const directoryPath of directoryPaths)\n    lddPaths.push(...(await executablesOrSharedLibraries(directoryPath)));\n  const allMissingDeps = await Promise.all(lddPaths.map(lddPath => missingFileDependencies(lddPath, directoryPaths)));\n  const missingDeps: Set<string> = new Set();\n  for (const deps of allMissingDeps) {\n    for (const dep of deps)\n      missingDeps.add(dep);\n  }\n  for (const dep of (await missingDLOPENLibraries(dlOpenLibraries)))\n    missingDeps.add(dep);\n  if (!missingDeps.size)\n    return;\n  // Check Ubuntu version.\n  const missingPackages = new Set();\n\n  const ubuntuVersion = await getUbuntuVersion();\n  let libraryToPackageNameMapping = null;\n  if (ubuntuVersion === '18.04')\n    libraryToPackageNameMapping = LIBRARY_TO_PACKAGE_NAME_UBUNTU_18_04;\n  else if (ubuntuVersion === '20.04')\n    libraryToPackageNameMapping = LIBRARY_TO_PACKAGE_NAME_UBUNTU_20_04;\n  else if (ubuntuVersion === '21.04')\n    libraryToPackageNameMapping = LIBRARY_TO_PACKAGE_NAME_UBUNTU_21_04;\n  libraryToPackageNameMapping = Object.assign({}, libraryToPackageNameMapping, MANUAL_LIBRARY_TO_PACKAGE_NAME_UBUNTU);\n  if (libraryToPackageNameMapping) {\n    // Translate missing dependencies to package names to install with apt.\n    for (const missingDep of missingDeps) {\n      const packageName = libraryToPackageNameMapping[missingDep];\n      if (packageName) {\n        missingPackages.add(packageName);\n        missingDeps.delete(missingDep);\n      }\n    }\n  }\n\n  const maybeSudo = (process.getuid() !== 0) && os.platform() !== 'win32' ? 'sudo ' : '';\n  // Happy path: known dependencies are missing for browsers.\n  // Suggest installation with a Playwright CLI.\n  if (missingPackages.size && !missingDeps.size) {\n    throw new Error('\\n' + utils.wrapInASCIIBox([\n      `Host system is missing a few dependencies to run browsers.`,\n      `Please install them with the following command:`,\n      ``,\n      `    ${maybeSudo}${buildPlaywrightCLICommand(sdkLanguage, 'install-deps')}`,\n      ``,\n      `<3 Playwright Team`,\n    ].join('\\n'), 1));\n  }\n\n  // Unhappy path - unusual distribution configuration.\n  let missingPackagesMessage = '';\n  if (missingPackages.size) {\n    missingPackagesMessage = [\n      `  Install missing packages with:`,\n      `      ${maybeSudo}apt-get install ${[...missingPackages].join('\\\\\\n          ')}`,\n      ``,\n      ``,\n    ].join('\\n');\n  }\n\n  let missingDependenciesMessage = '';\n  if (missingDeps.size) {\n    const header = missingPackages.size ? `Missing libraries we didn't find packages for:` : `Missing libraries are:`;\n    missingDependenciesMessage = [\n      `  ${header}`,\n      `      ${[...missingDeps].join('\\n      ')}`,\n      ``,\n    ].join('\\n');\n  }\n\n  throw new Error('Host system is missing dependencies!\\n\\n' + missingPackagesMessage + missingDependenciesMessage);\n}\n\nfunction isSharedLib(basename: string) {\n  switch (os.platform()) {\n    case 'linux':\n      return basename.endsWith('.so') || basename.includes('.so.');\n    case 'win32':\n      return basename.endsWith('.dll');\n    default:\n      return false;\n  }\n}\n\nasync function executablesOrSharedLibraries(directoryPath: string): Promise<string[]> {\n  const allPaths = (await fs.promises.readdir(directoryPath)).map(file => path.resolve(directoryPath, file));\n  const allStats = await Promise.all(allPaths.map(aPath => fs.promises.stat(aPath)));\n  const filePaths = allPaths.filter((aPath, index) => (allStats[index] as any).isFile());\n\n  const executablersOrLibraries = (await Promise.all(filePaths.map(async filePath => {\n    const basename = path.basename(filePath).toLowerCase();\n    if (isSharedLib(basename))\n      return filePath;\n    if (await checkExecutable(filePath))\n      return filePath;\n    return false;\n  }))).filter(Boolean);\n\n  return executablersOrLibraries as string[];\n}\n\nasync function missingFileDependenciesWindows(filePath: string): Promise<Array<string>> {\n  const executable = path.join(__dirname, '..', '..', 'bin', 'PrintDeps.exe');\n  const dirname = path.dirname(filePath);\n  const { stdout, code } = await utils.spawnAsync(executable, [filePath], {\n    cwd: dirname,\n    env: {\n      ...process.env,\n      LD_LIBRARY_PATH: process.env.LD_LIBRARY_PATH ? `${process.env.LD_LIBRARY_PATH}:${dirname}` : dirname,\n    },\n  });\n  if (code !== 0)\n    return [];\n  const missingDeps = stdout.split('\\n').map(line => line.trim()).filter(line => line.endsWith('not found') && line.includes('=>')).map(line => line.split('=>')[0].trim().toLowerCase());\n  return missingDeps;\n}\n\nasync function missingFileDependencies(filePath: string, extraLDPaths: string[]): Promise<Array<string>> {\n  const dirname = path.dirname(filePath);\n  let LD_LIBRARY_PATH = extraLDPaths.join(':');\n  if (process.env.LD_LIBRARY_PATH)\n    LD_LIBRARY_PATH = `${process.env.LD_LIBRARY_PATH}:${LD_LIBRARY_PATH}`;\n  const { stdout, code } = await utils.spawnAsync('ldd', [filePath], {\n    cwd: dirname,\n    env: {\n      ...process.env,\n      LD_LIBRARY_PATH,\n    },\n  });\n  if (code !== 0)\n    return [];\n  const missingDeps = stdout.split('\\n').map(line => line.trim()).filter(line => line.endsWith('not found') && line.includes('=>')).map(line => line.split('=>')[0].trim());\n  return missingDeps;\n}\n\nasync function missingDLOPENLibraries(libraries: string[]): Promise<string[]> {\n  if (!libraries.length)\n    return [];\n  // NOTE: Using full-qualified path to `ldconfig` since `/sbin` is not part of the\n  // default PATH in CRON.\n  // @see https://github.com/microsoft/playwright/issues/3397\n  const { stdout, code, error } = await utils.spawnAsync('/sbin/ldconfig', ['-p'], {});\n  if (code !== 0 || error)\n    return [];\n  const isLibraryAvailable = (library: string) => stdout.toLowerCase().includes(library.toLowerCase());\n  return libraries.filter(library => !isLibraryAvailable(library));\n}\n\n// This list is generted with the following program:\n// ./utils/linux-browser-dependencies/run.sh ubuntu:18.04\nconst LIBRARY_TO_PACKAGE_NAME_UBUNTU_18_04: { [s: string]: string} = {\n  'libasound.so.2': 'libasound2',\n  'libatk-1.0.so.0': 'libatk1.0-0',\n  'libatk-bridge-2.0.so.0': 'libatk-bridge2.0-0',\n  'libatspi.so.0': 'libatspi2.0-0',\n  'libbrotlidec.so.1': 'libbrotli1',\n  'libcairo-gobject.so.2': 'libcairo-gobject2',\n  'libcairo.so.2': 'libcairo2',\n  'libcups.so.2': 'libcups2',\n  'libdbus-1.so.3': 'libdbus-1-3',\n  'libdbus-glib-1.so.2': 'libdbus-glib-1-2',\n  'libdrm.so.2': 'libdrm2',\n  'libEGL.so.1': 'libegl1',\n  'libenchant.so.1': 'libenchant1c2a',\n  'libepoxy.so.0': 'libepoxy0',\n  'libevent-2.1.so.6': 'libevent-2.1-6',\n  'libevdev.so.2': 'libevdev2',\n  'libfontconfig.so.1': 'libfontconfig1',\n  'libfreetype.so.6': 'libfreetype6',\n  'libgbm.so.1': 'libgbm1',\n  'libgdk_pixbuf-2.0.so.0': 'libgdk-pixbuf2.0-0',\n  'libgdk-3.so.0': 'libgtk-3-0',\n  'libgdk-x11-2.0.so.0': 'libgtk2.0-0',\n  'libgio-2.0.so.0': 'libglib2.0-0',\n  'libGL.so.1': 'libgl1',\n  'libGLESv2.so.2': 'libgles2',\n  'libglib-2.0.so.0': 'libglib2.0-0',\n  'libgmodule-2.0.so.0': 'libglib2.0-0',\n  'libgobject-2.0.so.0': 'libglib2.0-0',\n  'libgstapp-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstaudio-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstbase-1.0.so.0': 'libgstreamer1.0-0',\n  'libgstcodecparsers-1.0.so.0': 'gstreamer1.0-plugins-bad',\n  'libgstfft-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstgl-1.0.so.0': 'libgstreamer-gl1.0-0',\n  'libgstpbutils-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstreamer-1.0.so.0': 'libgstreamer1.0-0',\n  'libgsttag-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstvideo-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgthread-2.0.so.0': 'libglib2.0-0',\n  'libgtk-3.so.0': 'libgtk-3-0',\n  'libgtk-x11-2.0.so.0': 'libgtk2.0-0',\n  'libharfbuzz-icu.so.0': 'libharfbuzz-icu0',\n  'libharfbuzz.so.0': 'libharfbuzz0b',\n  'libhyphen.so.0': 'libhyphen0',\n  'libicudata.so.60': 'libicu60',\n  'libicui18n.so.60': 'libicu60',\n  'libicuuc.so.60': 'libicu60',\n  'libjpeg.so.8': 'libjpeg-turbo8',\n  'libnotify.so.4': 'libnotify4',\n  'libnspr4.so': 'libnspr4',\n  'libnss3.so': 'libnss3',\n  'libnssutil3.so': 'libnss3',\n  'libopenjp2.so.7': 'libopenjp2-7',\n  'libopus.so.0': 'libopus0',\n  'libpango-1.0.so.0': 'libpango-1.0-0',\n  'libpangocairo-1.0.so.0': 'libpangocairo-1.0-0',\n  'libpangoft2-1.0.so.0': 'libpangoft2-1.0-0',\n  'libpng16.so.16': 'libpng16-16',\n  'libsecret-1.so.0': 'libsecret-1-0',\n  'libsmime3.so': 'libnss3',\n  'libvpx.so.5': 'libvpx5',\n  'libwayland-client.so.0': 'libwayland-client0',\n  'libwayland-egl.so.1': 'libwayland-egl1',\n  'libwayland-server.so.0': 'libwayland-server0',\n  'libwebp.so.6': 'libwebp6',\n  'libwebpdemux.so.2': 'libwebpdemux2',\n  'libwoff2dec.so.1.0.2': 'libwoff1',\n  'libX11-xcb.so.1': 'libx11-xcb1',\n  'libX11.so.6': 'libx11-6',\n  'libxcb-dri3.so.0': 'libxcb-dri3-0',\n  'libxcb-shm.so.0': 'libxcb-shm0',\n  'libxcb.so.1': 'libxcb1',\n  'libXcomposite.so.1': 'libxcomposite1',\n  'libXcursor.so.1': 'libxcursor1',\n  'libXdamage.so.1': 'libxdamage1',\n  'libXext.so.6': 'libxext6',\n  'libXfixes.so.3': 'libxfixes3',\n  'libXi.so.6': 'libxi6',\n  'libxkbcommon.so.0': 'libxkbcommon0',\n  'libxml2.so.2': 'libxml2',\n  'libXrandr.so.2': 'libxrandr2',\n  'libXrender.so.1': 'libxrender1',\n  'libxslt.so.1': 'libxslt1.1',\n  'libXt.so.6': 'libxt6',\n  'libXtst.so.6': 'libxtst6',\n};\n\n// This list is generted with the following program:\n// ./utils/linux-browser-dependencies/run.sh ubuntu:20.04\nconst LIBRARY_TO_PACKAGE_NAME_UBUNTU_20_04: { [s: string]: string} = {\n  'libasound.so.2': 'libasound2',\n  'libatk-1.0.so.0': 'libatk1.0-0',\n  'libatk-bridge-2.0.so.0': 'libatk-bridge2.0-0',\n  'libatspi.so.0': 'libatspi2.0-0',\n  'libcairo-gobject.so.2': 'libcairo-gobject2',\n  'libcairo.so.2': 'libcairo2',\n  'libcups.so.2': 'libcups2',\n  'libdbus-1.so.3': 'libdbus-1-3',\n  'libdbus-glib-1.so.2': 'libdbus-glib-1-2',\n  'libdrm.so.2': 'libdrm2',\n  'libEGL.so.1': 'libegl1',\n  'libenchant.so.1': 'libenchant1c2a',\n  'libevdev.so.2': 'libevdev2',\n  'libepoxy.so.0': 'libepoxy0',\n  'libfontconfig.so.1': 'libfontconfig1',\n  'libfreetype.so.6': 'libfreetype6',\n  'libgbm.so.1': 'libgbm1',\n  'libgdk_pixbuf-2.0.so.0': 'libgdk-pixbuf2.0-0',\n  'libgdk-3.so.0': 'libgtk-3-0',\n  'libgdk-x11-2.0.so.0': 'libgtk2.0-0',\n  'libgio-2.0.so.0': 'libglib2.0-0',\n  'libGL.so.1': 'libgl1',\n  'libGLESv2.so.2': 'libgles2',\n  'libglib-2.0.so.0': 'libglib2.0-0',\n  'libgmodule-2.0.so.0': 'libglib2.0-0',\n  'libgobject-2.0.so.0': 'libglib2.0-0',\n  'libgstapp-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstaudio-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstbase-1.0.so.0': 'libgstreamer1.0-0',\n  'libgstcodecparsers-1.0.so.0': 'gstreamer1.0-plugins-bad',\n  'libgstfft-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstgl-1.0.so.0': 'libgstreamer-gl1.0-0',\n  'libgstpbutils-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstreamer-1.0.so.0': 'libgstreamer1.0-0',\n  'libgsttag-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgstvideo-1.0.so.0': 'gstreamer1.0-plugins-base',\n  'libgthread-2.0.so.0': 'libglib2.0-0',\n  'libgtk-3.so.0': 'libgtk-3-0',\n  'libgtk-x11-2.0.so.0': 'libgtk2.0-0',\n  'libharfbuzz-icu.so.0': 'libharfbuzz-icu0',\n  'libharfbuzz.so.0': 'libharfbuzz0b',\n  'libhyphen.so.0': 'libhyphen0',\n  'libicui18n.so.66': 'libicu66',\n  'libicuuc.so.66': 'libicu66',\n  'libjpeg.so.8': 'libjpeg-turbo8',\n  'libnotify.so.4': 'libnotify4',\n  'libnspr4.so': 'libnspr4',\n  'libnss3.so': 'libnss3',\n  'libnssutil3.so': 'libnss3',\n  'libopenjp2.so.7': 'libopenjp2-7',\n  'libopus.so.0': 'libopus0',\n  'libpango-1.0.so.0': 'libpango-1.0-0',\n  'libpangocairo-1.0.so.0': 'libpangocairo-1.0-0',\n  'libpangoft2-1.0.so.0': 'libpangoft2-1.0-0',\n  'libpng16.so.16': 'libpng16-16',\n  'libsecret-1.so.0': 'libsecret-1-0',\n  'libsmime3.so': 'libnss3',\n  'libsoup-2.4.so.1': 'libsoup2.4-1',\n  'libvpx.so.6': 'libvpx6',\n  'libwayland-client.so.0': 'libwayland-client0',\n  'libwayland-egl.so.1': 'libwayland-egl1',\n  'libwayland-server.so.0': 'libwayland-server0',\n  'libwebp.so.6': 'libwebp6',\n  'libwebpdemux.so.2': 'libwebpdemux2',\n  'libwoff2dec.so.1.0.2': 'libwoff1',\n  'libX11-xcb.so.1': 'libx11-xcb1',\n  'libX11.so.6': 'libx11-6',\n  'libxcb-dri3.so.0': 'libxcb-dri3-0',\n  'libxcb-shm.so.0': 'libxcb-shm0',\n  'libxcb.so.1': 'libxcb1',\n  'libXcomposite.so.1': 'libxcomposite1',\n  'libXcursor.so.1': 'libxcursor1',\n  'libXdamage.so.1': 'libxdamage1',\n  'libXext.so.6': 'libxext6',\n  'libXfixes.so.3': 'libxfixes3',\n  'libXi.so.6': 'libxi6',\n  'libxkbcommon.so.0': 'libxkbcommon0',\n  'libxml2.so.2': 'libxml2',\n  'libXrandr.so.2': 'libxrandr2',\n  'libXrender.so.1': 'libxrender1',\n  'libxslt.so.1': 'libxslt1.1',\n  'libXt.so.6': 'libxt6',\n  'libXtst.so.6': 'libxtst6',\n  'libxshmfence.so.1': 'libxshmfence1',\n};\n\nconst LIBRARY_TO_PACKAGE_NAME_UBUNTU_21_04: { [s: string]: string} = {\n  'libasound.so.2': 'libasound2',\n  'libatk-1.0.so.0': 'libatk1.0-0',\n  'libatk-bridge-2.0.so.0': 'libatk-bridge2.0-0',\n  'libatspi.so.0': 'libatspi2.0-0',\n  'libcairo-gobject.so.2': 'libcairo-gobject2',\n  'libcairo.so.2': 'libcairo2',\n  'libcups.so.2': 'libcups2',\n  'libdbus-1.so.3': 'libdbus-1-3',\n  'libdbus-glib-1.so.2': 'libdbus-glib-1-2',\n  'libdrm.so.2': 'libdrm2',\n  'libEGL.so.1': 'libegl1',\n  'libepoxy.so.0': 'libepoxy0',\n  'libfontconfig.so.1': 'libfontconfig1',\n  'libfreetype.so.6': 'libfreetype6',\n  'libgbm.so.1': 'libgbm1',\n  'libgdk_pixbuf-2.0.so.0': 'libgdk-pixbuf-2.0-0',\n  'libgdk-3.so.0': 'libgtk-3-0',\n  'libgdk-x11-2.0.so.0': 'libgtk2.0-0',\n  'libgio-2.0.so.0': 'libglib2.0-0',\n  'libGL.so.1': 'libgl1',\n  'libGLESv2.so.2': 'libgles2',\n  'libglib-2.0.so.0': 'libglib2.0-0',\n  'libgmodule-2.0.so.0': 'libglib2.0-0',\n  'libgobject-2.0.so.0': 'libglib2.0-0',\n  'libgstapp-1.0.so.0': 'libgstreamer-plugins-base1.0-0',\n  'libgstaudio-1.0.so.0': 'libgstreamer-plugins-base1.0-0',\n  'libgstbase-1.0.so.0': 'libgstreamer1.0-0',\n  'libgstcodecparsers-1.0.so.0': 'libgstreamer-plugins-bad1.0-0',\n  'libgstfft-1.0.so.0': 'libgstreamer-plugins-base1.0-0',\n  'libgstgl-1.0.so.0': 'libgstreamer-gl1.0-0',\n  'libgstpbutils-1.0.so.0': 'libgstreamer-plugins-base1.0-0',\n  'libgstreamer-1.0.so.0': 'libgstreamer1.0-0',\n  'libgsttag-1.0.so.0': 'libgstreamer-plugins-base1.0-0',\n  'libgstvideo-1.0.so.0': 'libgstreamer-plugins-base1.0-0',\n  'libgthread-2.0.so.0': 'libglib2.0-0',\n  'libgtk-3.so.0': 'libgtk-3-0',\n  'libgtk-x11-2.0.so.0': 'libgtk2.0-0',\n  'libharfbuzz-icu.so.0': 'libharfbuzz-icu0',\n  'libharfbuzz.so.0': 'libharfbuzz0b',\n  'libhyphen.so.0': 'libhyphen0',\n  'libjavascriptcoregtk-4.0.so.18': 'libjavascriptcoregtk-4.0-18',\n  'libjpeg.so.8': 'libjpeg-turbo8',\n  'liblcms2.so.2': 'liblcms2-2',\n  'libnotify.so.4': 'libnotify4',\n  'libnspr4.so': 'libnspr4',\n  'libnss3.so': 'libnss3',\n  'libnssutil3.so': 'libnss3',\n  'libopenjp2.so.7': 'libopenjp2-7',\n  'libopus.so.0': 'libopus0',\n  'libpango-1.0.so.0': 'libpango-1.0-0',\n  'libpangocairo-1.0.so.0': 'libpangocairo-1.0-0',\n  'libpangoft2-1.0.so.0': 'libpangoft2-1.0-0',\n  'libpng16.so.16': 'libpng16-16',\n  'libsecret-1.so.0': 'libsecret-1-0',\n  'libsmime3.so': 'libnss3',\n  'libsoup-2.4.so.1': 'libsoup2.4-1',\n  'libvpx.so.6': 'libvpx6',\n  'libwayland-client.so.0': 'libwayland-client0',\n  'libwayland-egl.so.1': 'libwayland-egl1',\n  'libwayland-server.so.0': 'libwayland-server0',\n  'libwebkit2gtk-4.0.so.37': 'libwebkit2gtk-4.0-37',\n  'libwebp.so.6': 'libwebp6',\n  'libwebpdemux.so.2': 'libwebpdemux2',\n  'libwoff2dec.so.1.0.2': 'libwoff1',\n  'libwpe-1.0.so.1': 'libwpe-1.0-1',\n  'libWPEBackend-fdo-1.0.so.1': 'libwpebackend-fdo-1.0-1',\n  'libWPEWebKit-1.0.so.3': 'libwpewebkit-1.0-3',\n  'libX11-xcb.so.1': 'libx11-xcb1',\n  'libX11.so.6': 'libx11-6',\n  'libxcb-shm.so.0': 'libxcb-shm0',\n  'libxcb.so.1': 'libxcb1',\n  'libXcomposite.so.1': 'libxcomposite1',\n  'libXcursor.so.1': 'libxcursor1',\n  'libXdamage.so.1': 'libxdamage1',\n  'libXext.so.6': 'libxext6',\n  'libXfixes.so.3': 'libxfixes3',\n  'libXi.so.6': 'libxi6',\n  'libxkbcommon.so.0': 'libxkbcommon0',\n  'libxml2.so.2': 'libxml2',\n  'libXrandr.so.2': 'libxrandr2',\n  'libXrender.so.1': 'libxrender1',\n  'libxshmfence.so.1': 'libxshmfence1',\n  'libxslt.so.1': 'libxslt1.1',\n  'libXt.so.6': 'libxt6',\n};\n\nconst MANUAL_LIBRARY_TO_PACKAGE_NAME_UBUNTU: { [s: string]: string} = {\n  // libgstlibav.so (the only actual library provided by gstreamer1.0-libav) is not\n  // in the ldconfig cache, so we detect the actual library required for playing h.264\n  // and if it's missing recommend installing missing gstreamer lib.\n  // gstreamer1.0-libav -> libavcodec57 -> libx264-152\n  'libx264.so': 'gstreamer1.0-libav',\n};\n"],"file":"dependencies.js"}